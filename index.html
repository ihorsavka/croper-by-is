<html>
<head>
    <link href="./jquery-ui/jquery-ui.css" type="text/css" rel="stylesheet/less">
    <link rel="stylesheet" type="text/css"
href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.7.1/themes/base/jquery-ui.css"/>
<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.4.js"></script>
<script type="text/javascript" src="./jquery-ui/jquery-ui.js"></script>
<style media="screen">
.imageBox{
  width: 800px;
height: 400px;
}
.cropingBlock{
  min-width:200px;
  min-height: 200px;
  display: block;
  border: 1px dashed;
  position: absolute;
}
.imageBox img{
  width: 100%;
  height: 100%;
  display: inline-block;
}
.canvasDiv{
  display: inline-block;
}
</style>
</head>
<body>
  <div class="imageBox">
  <img id="img"/>
  <div class="cropingBlock resizeable draggable"></div>
</div>
<div class="canvasDiv"><canvas width="800" height="400" id="canvas"></canvas></div>

  <input type="file" id="input"></input>
  <input type="file" name="First Name" id="hidden"></input>

  <button onclick="canvasdraw()"> Cropp</button>
  <div>
    <button onclick="rotate()">rotate canvas</button>
    <button onclick="grayscale()">Grayscale the image</button>
    <button onclick="invert()">Invert image</button>
    <button onclick="saturate()">saturate image</button>
</div>
<input type="range" min="0" max="360" value="0" step="15" onchange="showValue(this.value)" />
<h4>Saturation</h4>
<input type="range" min="0" max="4" value="0" step="1" onchange="showSaturat(this.value)" />

<script type="text/javascript">
var c=document.getElementById("canvas");
var ctx=c.getContext("2d");
var img=document.getElementById("img");

$(".resizeable").resizable({
    containment: ".imageBox"
});


$(".draggable").draggable({
    cursor: "crosshair",
    containment: ".imageBox",
});
var input = document.getElementById('input');
function readURL(input) {

    if (input.files && input.files[0]) {
        var reader = new FileReader();

        reader.onload = function (e) {
            $('#img').attr('src', e.target.result);
        }

        reader.readAsDataURL(input.files[0]);
    }
}

$("#input").change(function(){
    readURL(this);
});

input.addEventListener('change', handleFiles);
 function canvasdraw  () {


    var diff = img.naturalWidth/img.width;
    var left = $('.draggable').offset().left*(img.naturalWidth/img.width);
    var top = $('.draggable').offset().top*(img.naturalHeight/img.height);
    console.log($(".resizeable").width());

ctx.save();
    ctx.clearRect(0, 0, 0, 0);
    ctx.restore();


    ctx.drawImage(img,left,top,$(".resizeable").height()*diff, $(".resizeable").width()*diff, 0, 0, $(".resizeable").width(), $(".resizeable").height());
    var hinput = $('input[name="First Name"]');
    hinput.val($(img).attr('src'));



}
function rotate(){
  console.log('rotate');
  ctx.translate($(".resizeable").width(),0 );
  ctx.rotate(90*Math.PI/180);
  ctx.drawImage(img,($('.draggable').offset().left*(img.naturalWidth/img.width))/2, ($('.draggable').offset().top*(img.naturalHeight/img.height))/2,$(".resizeable").height()*(img.naturalWidth/img.width), $(".resizeable").width()*(img.naturalWidth/img.width), 0, 0, $(".resizeable").width(), $(".resizeable").height());
}
function saturate(){
  var imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
  var dataArray = imageData.data;

  for(var i = 0; i < dataArray.length; i += 4)
  {
          var red = dataArray[i]; // 0 to 255
          var green = dataArray[i + 1]; // 0 to 255
          var blue = dataArray[i + 2]; // 0 to 255
          var alpha = dataArray[i + 3]; // 0 to 255

          dataArray[i] = 0.2 * red; // you can multiply the color and alpha values with a number between 0 and 1
          dataArray[i + 1] = 1 * green;
          dataArray[i + 2] = 1 * blue;
          dataArray[i + 3] = 1 * alpha;
  }

  ctx.putImageData(imageData, 0, 0);
  console.log(ctx.getImageData(0, 0, canvas.width, canvas.height));

}
// function showSaturat(text){
//   var imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
//   var dataArray = imageData.data;
//   console.log(text);
//
//   for(var i = 0; i < dataArray.length; i = text)
//   {
//           var red = dataArray[i]; // 0 to 255
//           var green = dataArray[i + 1]; // 0 to 255
//           var blue = dataArray[i + 2]; // 0 to 255
//           var alpha = dataArray[i + 3]; // 0 to 255
//
//           dataArray[i] = 0.2 * red; // you can multiply the color and alpha values with a number between 0 and 1
//           dataArray[i + 1] = 1 * green;
//           dataArray[i + 2] = 1 * blue;
//           dataArray[i + 3] = 1 * alpha;
//   }
//
//
//
//   ctx.putImageData(imageData, 0, 0);
//
//
// }



function grayscale(){
  var imageData = ctx.getImageData(0,0,canvas.width, canvas.height);
  var data = imageData.data;
  for (var i = 0; i < data.length; i += 4) {
  var avg = (data[i] + data[i +1] + data[i +2]) / 3;
  data[i]     = avg; // red
  data[i + 1] = avg; // green
  data[i + 2] = avg; // blue
}
ctx.putImageData(imageData, 0, 0);

};
function invert(){
  var imageData = ctx.getImageData(0,0,canvas.width, canvas.height);
  var data = imageData.data;
  for (var i = 0; i < data.length; i += 4) {
    data[i]     = 255 - data[i];     // red
    data[i + 1] = 255 - data[i + 1]; // green
    data[i + 2] = 255 - data[i + 2]; // blue
  }
  ctx.putImageData(imageData, 0, 0);

};

function showValue(newValue){
  console.log(newValue);
  c.width = $(".resizeable").width();
  c.height = $(".resizeable").width();

  ctx.translate(($(".resizeable").width())/2,($(".resizeable").width())/2);
  ctx.rotate(newValue*Math.PI/180);
  ctx.clearRect(0,0,10000,10000);
  ctx.drawImage(img,-($(".resizeable").width())/2, -($(".resizeable").width())/2);
}



</script>
</body>

</html>
