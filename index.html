<html>
<head>
    <link href="./jquery-ui/jquery-ui.css" type="text/css" rel="stylesheet/less">
    <link rel="stylesheet" type="text/css"
href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.7.1/themes/base/jquery-ui.css"/>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">


<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.4.js"></script>
<script type="text/javascript" src="./jquery-ui/jquery-ui.js"></script>
<style media="screen">
button, input[type=button]{
  background: none;
  border: none;
  font-size: 14px;
  color: #1b2024;
}
input[type=text]{
    text-align: center;
    width: 140px;
    color: #1b2024;
font-size: 36px;
}
button:hover, input[type=button]:hover{
  color: #328db3;
}
button:hover .fa, input[type=button]:hover .fa{
  color:#00baff;
}
button:hover span{
  border-color: #00baff;
}
button .fa, input[type=button] .fa{
  font-size: 48px;
  display: block;
  color:#6b6b6b;
}
button[name=Save]{
  background: green;
  border: medium none;
  font-size: 14px;
  color: white;
  border: 1px solid;
  border-radius: 5px;
  padding: 5px 10px;

}
button[name=Save] .fa{
  font-size: 16px;
  display: inline-block;
  padding-right: 5px;
  color: white;

}
.imageBox{
  width: 80%;
  text-align: center;
  min-height: 720px;
/*height: 400px;*/

}
/* Webkit Browsers*/
input[type=range]{
    -webkit-appearance: none;
}

input[type=range]::-webkit-slider-runnable-track {
    width: 300px;
    height: 5px;
    background: #ddd;
    border: none;
    border-radius: 3px;
}

input[type=range]::-webkit-slider-thumb {
    -webkit-appearance: none;
    border: 1px solid #6b6b6b;
    height: 20px;
    width: 20px;
    border-radius: 50%;
    background: #e5e2e2;
    margin-top: -4px;
}

input[type=range]:focus {
    outline: none;
}


input[type=range]:focus::-webkit-slider-runnable-track {
    background: #ccc;
}
/*Firefox emgin browsers*/
input[type=range]{
    /* fix for FF unable to apply focus style bug  */
    border: 1px solid white;

    /*required for proper track sizing in FF*/
    width: 300px;
}

input[type=range]::-moz-range-track {
    width: 300px;
    height: 5px;
    background: #ddd;
    border: none;
    border-radius: 3px;
}

input[type=range]::-moz-range-thumb {
    border: 1px solid #6b6b6b;
    height: 20px;
    width: 20px;
    border-radius: 50%;
    background: #e5e2e2;
}

/*hide the outline behind the border*/
input[type=range]:-moz-focusring{
    outline: 1px solid white;
    outline-offset: -1px;
}

input[type=range]:focus::-moz-range-track {
    background: #ccc;
}
/*IE Engine*/
input[type=range]::-ms-track {
    width: 300px;
    height: 5px;

    /*remove bg colour from the track, we'll use ms-fill-lower and ms-fill-upper instead */
    background: transparent;

    /*leave room for the larger thumb to overflow with a transparent border */
    border-color: transparent;
    border-width: 6px 0;

    /*remove default tick marks*/
    color: transparent;
}
input[type=range]::-ms-fill-lower {
    background: #777;
    border-radius: 10px;
}
input[type=range]::-ms-fill-upper {
    background: #ddd;
    border-radius: 10px;
}

input[type=range]::-ms-thumb {
    border: 1px solid #6b6b6b;
    height: 20px;
    width: 20px;
    border-radius: 50%;
    background: #e5e2e2;
}
input[type=range]:focus::-ms-fill-lower {
    background: #888;
}
input[type=range]:focus::-ms-fill-upper {
    background: #ccc;
}
.cropingBlock{
  width:200px;
  height: 200px;
  display: block;
  border: 2px solid #6b6b6b;
  position: absolute;
  top: 0px;
bottom: 0px;
left: 0;
right: 0;
margin: auto;
}
.memo{
  background: #f8f8f8;
  text-align: center;
  margin: 20px 0px;
}
.imageBox{
    position: relative;
    margin: 0 auto;
}
.imageBox img{
  max-width: 100%;
  max-height: 100%;
  display: inline-block;
  text-align: center;



}
.imageBox img{
  max-width: 100%;
  max-height: 100%;
  display: inline-block;
  text-align: center;
  min-width: 100%;


}
.canvasDiv{
  display: inline-block;
}
.menu{
  display: none;
}
.maine-box{
  background: white;
  width: 80vw;
}
.menu{
  background: #f8f8f8;
  text-align: center;
}
.btn-gr{
  background: #e5e2e2;
border-radius: 5px;
font-size: 14px;
color: #6b6b6b;
padding: 5px 10px;
}
.br-scroll, .ct-scroll{
  margin: 10px 0px;
}
.box{
  display: block;
width: 70px;
height: 70px;
border: 2px solid rgb(107, 107, 107);
margin: 10px auto;
}
.free-asp{
  border: 2px dashed rgb(107, 107, 107);
}
.for-asp{
  height: 53px;
}
.tree-asp{
  height: 47px;
}
.nine-asp{
  height: 40px;
}
.rr-asp{
  height: 20px;
}


</style>
</head>
<body>

    <input type="file" id="input"></input>
<div class="maine-box">
  <section class="menu memo">
    <button onclick="openCroper()"><i class="fa fa-crop"></i>Croper</button>
    <button onclick="openRotate()"> <i class="fa fa-undo"></i>Rotate</button>
    <button onclick="openEdit()"><i class="fa fa-eyedropper"></i>Edit</button>
    <button onclick="openResize()"><i class="fa fa-arrows-alt"></i>Resize</button>
    <button onclick="openSharpe()"><i class="fa fa-diamond"></i>Sharpnes</button>


  </section>
  <div class='edit memo'>
      <button type="button" onclick="backe()" name="Save"><i class="fa fa-floppy-o"></i>Back</button>
      <!-- <button onclick="brightness(10)"><i class="fa fa-adjust"></i>Lighter</button> -->
      <button class="btn-gr" onclick="openBr()">Brigtness</button>
      <button class="btn-gr" onclick="openCont()">Contrast</button>

      <!-- <input type="button" onclick="brightness(10)" value="Lighter" /> -->
      <!-- <button onclick="brightness(-10)"><i class="fa fa-adjust"></i>Darker</button> -->
      <!-- <input type="button" onclick="brightness(-10)" value="Darker" /> -->
      <!-- <button onclick="contrast(10)"><i class="fa fa-moon-o"></i>More</button> -->
       <!-- <input type="button" onclick="contrast(10)" value="More" /> -->

      <!-- <button onclick="contrast(-10)"><i class="fa fa-sun-o"></i>Less</button> -->
      <!-- <input type="button" onclick="contrast(-10)" value="Less" /> -->
      <button class="btn-gr" onclick="grayscale()">Grayscale the image</button>
      <button class="btn-gr" onclick="invert()">Invert image</button>
      <button class="btn-gr" onclick="saturate()">saturate image</button>
      <button class="btn-gr" onclick="bluer()">bluer image</button>

      <button type="button" onclick="save()" name="Save"><i class="fa fa-floppy-o"></i>Save</button>
      <div class="br-scroll">
        <input type="range" min="-100" max="100" value="0" step="10" onchange=" brightnessScroll(this.value)" />

      </div>
      <div class="ct-scroll">
        <input type="range" min="-50" max="50" value="0" step="5" onchange="contrastScroll(this.value)" />

      </div>
  </div>
  <div class='sharp memo'>
        <button type="button" onclick="backe()" name="Save"><i class="fa fa-floppy-o"></i>Backe</button>
        <input type=range id=mix min=0 max=100 value=00 onchange="update(this.value)">
        <button type="button" onclick="save()" name="Save"><i class="fa fa-floppy-o"></i>Save</button>
  </div>
  <div class="function-buttons memo">


  </div>
  <div class="memo">
    <button type="button" class="crop" onclick="backe()" name="Save"><i class="fa fa-floppy-o"></i>Backe</button>
    <button class='crop btn-gr' onclick="canvasdraw()"> Cropp</button>
        <button class='crop ' onclick="freeAsp()"> <span class="box free-asp"></span>Free Aspect ratio</button>
        <button class='crop ' onclick="oneAsp()"> <span class="box"></span>1:1</button>
    <button class='crop ' onclick="camAsp()"><span class="box for-asp"></span> 4:3</button>
    <button class='crop ' onclick="cybAsp()"><span class="box tree-asp"></span> 3:2</button>
    <button class='crop ' onclick="picAsp()"><span class="box nine-asp"></span> 16:9</button>
    <button class='crop ' onclick="realAspectRatio()"><span class="box rr-asp"></span> Real aspectRatio</button>

    <button type="button" onclick="save()" name="Save" class="crop"><i class="fa fa-floppy-o"></i>Save</button>
  </div>
    <div class='rotate memo'>
      <button type="button" onclick="backe()" name="Save"><i class="fa fa-floppy-o"></i>Backe</button>
      <button class="btn-gr" onclick="rotate()">rotate canvas</button>
      <button class="btn-gr" onclick="flip()">flip canvas</button>
      <button class="btn-gr" onclick="openRT()">flip canvas</button>
      <!-- <button onclick="resizeClicked()">newRotate()</button> -->

      <!-- <input type="range" min="0" max="180" value="0" step="1" oninput="showValue(this.value)" /> -->
      <!-- <input type="range" min="0" max="180" value="0" step="1" oninput="miniShowValue(this.value)"/> -->
      <!-- <span>Zoom</span>
      <input type="range" min="1" max="5" value="1" step="0.1" oninput="scale(this.value)" /> -->
      <button type="button" onclick="save()" name="Save"><i class="fa fa-floppy-o"></i>Save</button>

  </div>
  <div class="memo rt-scroll">
    <button type="button" onclick="backe()" name="Save"><i class="fa fa-floppy-o"></i>Backe</button>
  <span>Rotate</span>
    <input type="range" min="0" max="180" value="0" step="1" oninput="miniShowValue(this.value)" onchange="showValue(this.value)" />
          <button type="button" onclick="save()" name="Save"><i class="fa fa-floppy-o"></i>Save</button>
</div>
  <div class='resize memo'>
    <button type="button" onclick="backe()" name="Save"><i class="fa fa-floppy-o"></i>Backe</button>

    <!-- <button onclick="resizeClicked()">newRotate()</button> -->
    <input type="number" id="widthinput"  onchange="resize(this.value)" />
    <input type="number"   id="heightinput"  onchange="resize(this.value)" />
    <button type="button" onclick="save()" name="Save"><i class="fa fa-floppy-o"></i>Save</button>

  </div>

  <div class="imageBox">

  <img id="img"/>
  <img id="previw"/>
  <img id="initImg"/>
  <canvas width="800"  height="400" id="miniCanvas" style="position: absolute; left: 0px; z-index: 5000;"></canvas>

  <div class="cropingBlock resizeable draggable"></div>
</div>
<div class="memo">
  <button type="button" onclick="roleBack()"><i class="fa fa-reply"></i></button>
  <button type="button" onclick="roleFront()" ><i class="fa fa-share"></i></button>
  <button type="button" class="show-init" onclick="showInit()" >Show initial imag</button>
  <button type="button" class="hide-init" onclick="hideInit()" >hide initial image</button>
</div>
<div class="canvasDiv">
  <canvas width="800"  style="visibility:hiden;"height="400" id="canvas"></canvas>

</div>



</div>

<script type="text/javascript">
var saveObj = {};

var c=document.getElementById("canvas");
var ctx=c.getContext("2d");
var miniC=document.getElementById("miniCanvas");
var miniCtx=miniC.getContext("2d");
var img=document.getElementById("img");
var imgWidth = 200;
var imgHeight = 300;
var size = {
    width: imgWidth,
    height: imgHeight
};
var rotation = 0;
var deg2Rad = Math.PI / 180;
var count1 = 0;
var count2 = 0;
var valueD = 0;
var counter = 0;
/////function for fading in
function update(newVal) {
      ctx.drawImage(img,0,0,img.naturalWidth,img.naturalHeight);
    sharpen(ctx, img.naturalWidth, img.naturalHeight, parseInt(newVal) * 0.01);
    $('#previw').attr('src',c.toDataURL('image/jpeg') );
}
function sharpen(ctx, w, h, mix) {

    var weights = [0, -1, 0, -1, 5, -1, 0, -1, 0],
        katet = Math.round(Math.sqrt(weights.length)),
        half = (katet * 0.5) | 0,
        dstData = ctx.createImageData(w, h),
        dstBuff = dstData.data,
        srcBuff = ctx.getImageData(0, 0, w, h).data,
        y = h;

    while (y--) {

        x = w;

        while (x--) {

            var sy = y,
                sx = x,
                dstOff = (y * w + x) * 4,
                r = 0,
                g = 0,
                b = 0,
                a = 0;

            for (var cy = 0; cy < katet; cy++) {
                for (var cx = 0; cx < katet; cx++) {

                    var scy = sy + cy - half;
                    var scx = sx + cx - half;

                    if (scy >= 0 && scy < h && scx >= 0 && scx < w) {

                        var srcOff = (scy * w + scx) * 4;
                        var wt = weights[cy * katet + cx];

                        r += srcBuff[srcOff] * wt;
                        g += srcBuff[srcOff + 1] * wt;
                        b += srcBuff[srcOff + 2] * wt;
                        a += srcBuff[srcOff + 3] * wt;
                    }
                }
            }

            dstBuff[dstOff] = r * mix + srcBuff[dstOff] * (1 - mix);
            dstBuff[dstOff + 1] = g * mix + srcBuff[dstOff + 1] * (1 - mix);
            dstBuff[dstOff + 2] = b * mix + srcBuff[dstOff + 2] * (1 - mix)
            dstBuff[dstOff + 3] = srcBuff[dstOff + 3];
        }
    }

    ctx.putImageData(dstData, 0, 0);
}


function fade(){
  $('#canvas').fadeOut();
  $('#initImg').fadeOut();
  $('.hide-init').fadeOut();
  $('.show-init').fadeIn();
  $('#miniCanvas').fadeOut();
  $('.rt-scroll').fadeOut();
  $('.crop').fadeOut();
  $('.cropingBlock').fadeOut();
  $('.edit').fadeOut();
  $('.rotate').fadeOut();
  $('.resize').fadeOut();
  $('.function-buttons').fadeOut();
  $('.sharp').fadeOut();
  $('.br-scroll').fadeOut();
  $('.ct-scroll').fadeOut();
}
function backe(){
  fade();
  $('.menu').fadeIn();
  $('#previw').fadeIn();

}
function showInit(){
  $('#initImg').fadeIn();
  $('.hide-init').fadeIn();
  $('.show-init').fadeOut();
}
function hideInit(){
  $('#initImg').fadeOut();
  $('.hide-init').fadeOut();
  $('.show-init').fadeIn();
}
function openRT(){
  $('#miniCanvas').fadeIn();
  $('.rt-scroll').fadeIn();
  $('#previw').fadeOut();
  $('.rotate').fadeOut();
  save();
}
fade();
////opening croper
function openCroper(){
  fade();
  $('.crop').fadeIn();
  $('.cropingBlock').fadeIn();
  $('.function-buttons').fadeIn();
  cropInit();
  $('.menu').fadeOut();

}
function openBr(){
  $('.ct-scroll').fadeOut();
  $('.br-scroll').fadeIn();
  save();
}
function openCont(){
  $('.br-scroll').fadeOut();
  save();
  $('.ct-scroll').fadeIn();
}


///opening rotations

function openRotate(){
  backe();
  fade();
  $('.menu').fadeOut();
  $('.rotate').fadeIn();
  $('.function-buttons').fadeIn();
  c.width = img.naturalWidth;
  c.height =  img.naturalHeight;
  miniC.width = img.width;
  miniC.height =  img.height;
  $('#img').fadeOut();
  $('#previw').fadeIn();
ctx.drawImage(img,0,0,img.naturalWidth,img.naturalHeight);
miniCtx.drawImage(img,0,0,img.width,img.height);
$('#previw').attr('src',c.toDataURL('image/jpeg') );
save();

}
function openSharpe(){
  fade();
  $('.menu').fadeOut();
  $('.sharp').fadeIn();
  $('.function-buttons').fadeIn();
  c.width = img.naturalWidth;
  c.height =  img.naturalHeight;
  $('#img').fadeOut();
  $('#previw').fadeIn();
ctx.drawImage(img,0,0,img.naturalWidth,img.naturalHeight);
$('#previw').attr('src',c.toDataURL('image/jpeg') );
save();

}
function openResize(){
  fade();
  $('.menu').fadeOut();
  $('.resize').fadeIn();
  $('.function-buttons').fadeIn();
  c.width = img.naturalWidth;
  c.height =  img.naturalHeight;
  console.log($('#widthinput'));
  $('#widthinput').attr('value',img.naturalWidth);
  $('#heightinput').attr('value',img.naturalHeight);

  $('#img').fadeOut();
  $('#previw').fadeIn();
ctx.drawImage(img,0,0,img.naturalWidth,img.naturalHeight);
$('#previw').attr('src',c.toDataURL('image/jpeg') );

}

function openEdit(){
  fade();
    $('.menu').fadeOut();
  $('.edit').fadeIn();
  $('.function-buttons').fadeIn();
  c.width = img.naturalWidth;
  c.height =  img.naturalHeight;
  $('#img').fadeOut();
  $('#previw').fadeIn();
  ctx.drawImage(img,0,0,img.naturalWidth,img.naturalHeight);
  $('#previw').attr('src',c.toDataURL('image/jpeg') );

}


/////Functions for croping zone

function cropInit(croperMinWidth,croperMinHeight,croperAspRat){



  $(".resizeable").resizable("destroy").resizable({
      containment: ".imageBox",
        minWidth: croperMinWidth,
        minHeight: croperMinHeight,
        aspectRatio: croperAspRat,


  });
}

$(".resizeable").resizable({
    containment: ".imageBox",



});

$(".draggable").draggable({
    cursor: "crosshair",
    containment: ".imageBox",
});
function picAsp(){
  var croperMinWidth = 310;
  var croperMinHeight = 173;
  var croperAspRat = true;
  $(".resizeable").css({
    "width": croperMinWidth,
    "height": croperMinHeight,
    "min-width": croperMinWidth,
    "min-height": croperMinHeight
  });
    cropInit(croperMinWidth,croperMinHeight,croperAspRat);
}
function oneAsp(){
  var croperMinWidth = 173;
  var croperMinHeight = 173;
  var croperAspRat = true;
  $(".resizeable").css({
    "width": croperMinWidth,
    "height": croperMinHeight,
    "min-width": croperMinWidth,
    "min-height": croperMinHeight
  });
    cropInit(croperMinWidth,croperMinHeight,croperAspRat);
}
function cybAsp(){
  var croperMinWidth = 240
  var croperMinHeight = 160;
  var croperAspRat = true;
  $(".resizeable").css({
    "width": croperMinWidth,
    "height": croperMinHeight,
    "min-width": croperMinWidth,
    "min-height": croperMinHeight
  });
    cropInit(croperMinWidth,croperMinHeight,croperAspRat);
}
function realAspectRatio(){
  if(img.naturalWidth > img.naturalHeight){

    var croperMinWidth = img.naturalWidth/10;
    var croperMinHeight = img.naturalHeight/10;
    console.log(croperMinWidth);
    console.log(croperMinHeight);
    var croperAspRat = true;

    $(".resizeable").css({
      "width": croperMinWidth,
      "height": croperMinHeight,
      "min-width": croperMinWidth,
      "min-height": croperMinHeight
    });
      cropInit(croperMinWidth,croperMinHeight,croperAspRat);
  }else if (img.naturalWidth === img.naturalHeight){

    var croperMinWidth = 200;
    var croperMinHeight = 200;
    var croperAspRat = true;
    $(".resizeable").css({
      "width": croperMinWidth,
      "height": croperMinHeight,
      "min-width": croperMinWidth,
      "min-height": croperMinHeight
    });
      cropInit(croperMinWidth,croperMinHeight,croperAspRat);

  }else{
    console.log('height');
    var croperMinWidth = 200*((img.naturalWidth+100)/img.naturalWidth);
    var croperMinHeight = 300;
    var croperAspRat = true;
    $(".resizeable").css({
      "width": croperMinWidth,
      "height": croperMinHeight,
      "min-width": croperMinWidth,
      "min-height": croperMinHeight
    });
      cropInit(croperMinWidth,croperMinHeight,croperAspRat);

  }

}
function camAsp(){
  var croperMinWidth = 284;
  var croperMinHeight = 213;
  var croperAspRat = true;
  $(".resizeable").css({
    "width": croperMinWidth,
    "height": croperMinHeight,
    "min-width": croperMinWidth,
    "min-height": croperMinHeight
  });
    cropInit(croperMinWidth,croperMinHeight,croperAspRat);
}
function freeAsp(){
  var croperMinWidth = 150;
  var croperMinHeight = 150;
  var croperAspRat = false;
  $(".resizeable").css({
    "width": croperMinWidth,
    "height": croperMinHeight,
    "min-width": croperMinWidth,
    "min-height": croperMinHeight
  });
  console.log(  $(".resizeable").resizable());
  cropInit(croperMinWidth,croperMinHeight,croperAspRat);
}

//////canvas Functions
var memoCount = 0;

var input = document.getElementById('input');
function save(){
  memoCount ++;
  // $('#img').fadeIn();
  // $('#previw').fadeOut();
  saveObj[memoCount] = c.toDataURL('image/jpeg');
  // $('.menu').fadeIn();
  $('#img').attr('src',c.toDataURL('image/jpeg') );
  $('#previw').attr('src',c.toDataURL('image/jpeg') );



  // fade();
}
function roleBack(){

if (memoCount > 1){
  memoCount = memoCount -1;
  $('.menu').fadeIn();
  var id = memoCount;

  console.log('src',id);
  console.log('src',memoCount);
  $('#img').attr('src',saveObj[id]);
  $('#previw').attr('src',saveObj[id]);
}else{
  var id = 0;
  $('.menu').fadeIn();
  console.log('src',saveObj[id]);
  $('#img').attr('src',saveObj[id]);
  $('#previw').attr('src',saveObj[id]);
}


  fade();
}
function roleFront(){
 memoCount = memoCount +1;
var id = memoCount;
console.log('src',id);
console.log('src',memoCount);
$('.menu').fadeIn();

if (id >= memoCount){
  id = memoCount;



  $('#img').attr('src',saveObj[id]);
  $('#previw').attr('src',saveObj[id]);
}else{


  $('#img').attr('src',saveObj[id]);
  $('#previw').attr('src',saveObj[id]);
}


  fade();
}







/////reading url from the input


function readURL(input) {

    if (input.files && input.files[0]) {
        var reader = new FileReader();

        reader.onload = function (e) {
            saveObj[0] = e.target.result;
            $('#img').attr('src', saveObj[0]);
              $('#initImg').attr('src', saveObj[0]);

        }

        reader.readAsDataURL(input.files[0]);
    }
}

$("#input").change(function(){
    readURL(this);
    $('.menu').fadeIn();
});

input.addEventListener('change', handleFiles);


////croping
 function canvasdraw  () {


    var diff = img.naturalWidth/img.width;
    c.width = $(".resizeable").width()*diff;
    c.height =  $(".resizeable").height()*diff;;
    var left = $('.draggable').position().left*(img.naturalWidth/img.width);
    var top = $('.draggable').position().top*(img.naturalHeight/img.height);
    console.log(c.width);


ctx.save();
    ctx.clearRect(left,top,$(".resizeable").height()*diff, $(".resizeable").width()*diff);
    ctx.restore();


    ctx.drawImage(img,left,top,c.width, c.height, 0, 0, c.width, c.height);
    $('#previw').attr('src',c.toDataURL('image/jpeg') );
    $('#img').fadeOut();
    $('#previw').fadeIn();

    save();


}
function wChangeInp(value){

}
 function resize(value) {

var sizeDiff =  parseInt(value)/img.naturalWidth;
console.log(parseInt(value));
console.log(sizeDiff);
c.width =  parseInt(value);
c.height =  img.naturalHeight * sizeDiff;
var h = img.naturalHeight * sizeDiff;


ctx.save();
    ctx.clearRect(0,0,c.width, c.height);
    ctx.restore();


    ctx.drawImage(img,0,0,img.naturalWidth, img.naturalHeight, 0, 0,   c.width,c.height);

    $('#heightinput').attr('value',h);
    $('#previw').attr('src',c.toDataURL('image/jpeg') );

}
function resizeH(value) {

var sizeDiff = parseInt(value)/img.naturalHeight;
c.width = img.naturalWidth * sizeDiff;
var w = img.naturalWidth * sizeDiff;
c.height =   parseInt(value);


ctx.save();
   ctx.clearRect(0,0,c.width, c.height);
   ctx.restore();


   ctx.drawImage(img,0,0,img.naturalWidth, img.naturalHeight, 0, 0,   c.width,c.height);

   $('#widthinput').attr('value',w);

   $('#previw').attr('src',c.toDataURL('image/jpeg') );

}
// function rotate(){
//   counter++;
//   if (counter < 4){
//     valueD = valueD + 90;
//   } else{
//     counter = 0;
//     valueD = 0;
//   }
//   rotateA();
//   memoCount ++;
//   // $('#img').fadeIn();
//   // $('#previw').fadeOut();
//   saveObj[memoCount] = c.toDataURL('image/jpeg');
//   // rotateB();
// }
function rotate(){
  var imgDiffWidth = 0;
  var imgDiffHeight = -img.naturalHeight;

  var trDiffWidth = 0;
  var trDiffHeight =(img.naturalHeight);
  c.width = img.naturalHeight;
  c.height = img.naturalWidth;
  ctx.clearRect(0,0,canvas.width,canvas.height);


  ctx.save();
  // ctx.translate(trDiffWidth,trDiffHeight);
  // ctx.translate(0,0);
  ctx.rotate(90*Math.PI/180);
  // ctx.rotate(90*Math.PI/180);


ctx.drawImage(img, 0,-img.naturalHeight,img.naturalWidth,img.naturalHeight);
// ctx.drawImage(img, 0,0,img.naturalWidth,img.naturalHeight);
    ctx.restore();
    $('#previw').attr('src',c.toDataURL('image/jpeg') );
  save();
  // rotateB();
}
function rotateA(){




  if (  valueD == 90){
    console.log("1 || 3")
    var imgDiffWidth = 0;
    var imgDiffHeight = -img.naturalHeight;

    var trDiffWidth = 0;
    var trDiffHeight =(img.naturalHeight);
    c.width = img.naturalHeight;
    c.height = img.naturalWidth;
}else if(valueD == 270){
  var imgDiffWidth = -(img.naturalWidth);
  var imgDiffHeight = 0;
  var trDiffWidth = img.naturalHeight/2;
  var trDiffHeight =(img.naturalWidth)/2;
  c.width = img.naturalHeight;
  c.height = img.naturalWidth;

}else if(valueD == 180){
    console.log('2');
    var imgDiffWidth = -(img.naturalWidth);
    var imgDiffHeight = -(img.naturalHeight);
    var trDiffWidth = 0;
    var trDiffHeight =0;
    c.width =  img.naturalWidth;
    c.height = img.naturalHeight;

  }else{
    var imgDiffWidth = 0;
    var imgDiffHeight = 0;
    var trDiffWidth = 0;
    var trDiffHeight =0;
    c.width =  img.naturalWidth;
    c.height = img.naturalHeight;
  }
  ctx.clearRect(0,0,canvas.width,canvas.height);


  ctx.save();
  // ctx.translate(trDiffWidth,trDiffHeight);
  ctx.translate(0,0);
  ctx.rotate(valueD*Math.PI/180);
  // ctx.rotate(90*Math.PI/180);


ctx.drawImage(img, imgDiffWidth,imgDiffHeight,img.naturalWidth,img.naturalHeight);
// ctx.drawImage(img, 0,0,img.naturalWidth,img.naturalHeight);
    ctx.restore();
    $('#previw').attr('src',c.toDataURL('image/jpeg') );



}

function rotateB(){



  console.log  ( valueD);
  if (  valueD == 90){
    console.log("1 || 3")
    var imgDiffWidth = -(img.width)/1.7777;
    var imgDiffHeight = -(img.height);

    var trDiffWidth = 0;
    var trDiffHeight =(img.height);
    miniC.width = img.height;
    miniC.height = img.width;
  }else if(valueD == 270){
  var imgDiffWidth = -(img.width)/2;
  var imgDiffHeight = -(img.height)/2;
  var trDiffWidth = img.height/2;
  var trDiffHeight =(img.width)/2;
  miniC.width = img.height;
  miniC.height = img.width;

  }else{
    console.log('2');
    var imgDiffWidth = -(img.width)/2;
    var imgDiffHeight = -(img.height)/2;
    var trDiffWidth = (img.width)/2;
    var trDiffHeight =(img.height)/2;
    miniC.width =  img.width;
    miniC.height = img.height;

  }
  miniCtx.clearRect(0,0,canvas.width,canvas.height);


  miniCtx.save();
  miniCtx.translate(trDiffWidth,trDiffHeight);
  miniCtx.rotate(valueD*Math.PI/180);


  miniCtx.drawImage(img, imgDiffWidth,imgDiffHeight,img.width,img.height);
    miniCtx.restore();


    // $('#previw').attr('src',c.toDataURL('image/jpeg') );


}
function flip(){


  ctx.scale(1, -1);
ctx.translate(0, -img.naturalHeight);
ctx.drawImage(img, 0,0, img.naturalWidth, img.naturalHeight);
$('#previw').attr('src',c.toDataURL('image/jpeg') );
memoCount ++;
// $('#img').fadeIn();
// $('#previw').fadeOut();
saveObj[memoCount] = c.toDataURL('image/jpeg');
}
function saturate(){
  var imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
  var dataArray = imageData.data;

  for(var i = 0; i < dataArray.length; i += 4)
  {
          var red = dataArray[i]; // 0 to 255
          var green = dataArray[i + 1]; // 0 to 255
          var blue = dataArray[i + 2]; // 0 to 255
          var alpha = dataArray[i + 3]; // 0 to 255

          dataArray[i] = 1.5 * red; // you can multiply the color and alpha values with a number between 0 and 1
          dataArray[i + 1] = 1.5 * green;
          dataArray[i + 2] = 1.5 * blue;
          dataArray[i + 3] = 1 * alpha;
  }

  ctx.putImageData(imageData, 0, 0);
  console.log(ctx.getImageData(0, 0, canvas.width, canvas.height));
$('#previw').attr('src',c.toDataURL('image/jpeg') );
save();
}
function bluer(){
  var imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
  var dataArray = imageData.data;
  ctx.globalAlpha = 0.1;

for (var y=0;y<50;++y) ctx.drawImage(img,y,y,img.naturalWidth, img.naturalHeight);
  $('#img').attr('src',c.toDataURL('image/jpeg') );


for (var y=0;y>-50;--y) ctx.drawImage(img,y,y,img.naturalWidth, img.naturalHeight);
  $('#previw').attr('src',c.toDataURL('image/jpeg') );
  save();

}



function grayscale(){
  var imageData = ctx.getImageData(0,0,canvas.width, canvas.height);
  var data = imageData.data;
  for (var i = 0; i < data.length; i += 4) {
  var avg = (data[i] + data[i +1] + data[i +2]) / 3;
  data[i]     = avg; // red
  data[i + 1] = avg; // green
  data[i + 2] = avg; // blue
}
ctx.putImageData(imageData, 0, 0);
$('#previw').attr('src',c.toDataURL('image/jpeg') );
save();

};
function invert(){
  var imageData = ctx.getImageData(0,0,canvas.width, canvas.height);
  var data = imageData.data;
  for (var i = 0; i < data.length; i += 4) {
    data[i]     = 255 - data[i];     // red
    data[i + 1] = 255 - data[i + 1]; // green
    data[i + 2] = 255 - data[i + 2]; // blue
  }
  ctx.putImageData(imageData, 0, 0);
$('#previw').attr('src',c.toDataURL('image/jpeg') );
save();
};

function showValue(newValue){

  ctx.clearRect(0,0,canvas.width,canvas.height);
  var imgDiffWidth = img.naturalWidth;
  var imgDiffHeight = img.naturalHeight;
  // var wDif = imgDiffWidth + newValue * (newValue/1.3);
  // var wDifSize = imgDiffWidth + newValue * (newValue);
  ctx.save();
  ctx.translate((imgDiffWidth)/2,(imgDiffHeight)/2);
  ctx.rotate(newValue*Math.PI/180);


  ctx.drawImage(img,-(img.naturalWidth)/2, -(img.naturalHeight)/2,img.naturalWidth,img.naturalHeight);
    ctx.restore();
    $('#previw').attr('src',c.toDataURL('image/jpeg') );
}
function miniShowValue(newValue){

  miniCtx.clearRect(0,0,miniC.width,miniC.height);
  var imgDiffWidth = miniC.width;
  var imgDiffHeight = miniC.height;
  // var wDif = imgDiffWidth + newValue * (newValue/1.3);
  // var wDifSize = imgDiffWidth + newValue * (newValue);
  miniCtx.save();
  miniCtx.translate((miniC.width)/2,(miniC.height)/2);
  miniCtx.rotate(newValue*Math.PI/180);


  miniCtx.drawImage(img,-(miniC.width)/2, -(miniC.height)/2,miniC.width,miniC.height);
    miniCtx.restore();

}
function changeColorValue(sobj, val){
  //

}
var scaleVal = 0;
function scale(newValue){
  console.log(newValue);
  ctx.clearRect(0,0,canvas.width,canvas.height);
  var imgDiffWidth = img.naturalWidth;
  var imgDiffHeight = img.naturalHeight;
  // var wDif = imgDiffWidth + newValue * (newValue/1.3);
  // var wDifSize = imgDiffWidth + newValue * (newValue);
  ctx.save();
  // ctx.translate((imgDiffWidth)/2,(imgDiffHeight)/2);
  ctx.scale( newValue, newValue);
  ctx.translate((imgDiffWidth)/newValue,(imgDiffHeight)/newValue);
ctx.drawImage(img,(imgDiffWidth)/-newValue,(imgDiffHeight)/-newValue,img.naturalWidth,img.naturalHeight);

//   if (newValue > 2){
//
// }else{
//       ctx.translate(newValue,(newValue);
//   ctx.drawImage(img,0,0,img.naturalWidth,img.naturalHeight);
// }
    ctx.restore();
    $('#previw').attr('src',c.toDataURL('image/jpeg') );
}
function changeColorValue(sobj, val){
  $('#previw').attr('src',c.toDataURL('image/jpeg') );

}

/////FUNCTIONALYTI

function brightness(amount){
  // ctx.drawImage(img, 0,0, img.naturalWidth, img.naturalHeight);
	var data = ctx.getImageData(0,0,canvas.width,canvas.height);//get pixel data
	var pixels = data.data;
    console.log(amount);
	for(var i = 0; i < pixels.length; i+=4){//loop through all data
		pixels[i] += amount;
		pixels[i+1] += amount;
		pixels[i+2] += amount;
	}
	data.data = pixels;


	ctx.putImageData(data,0,0);//put the image data back
  $('#previw').attr('src',c.toDataURL('image/jpeg') );
}
function brightnessScroll(amount){
var a = parseInt(amount);
ctx.drawImage(img, 0,0, img.naturalWidth, img.naturalHeight);
var data = ctx.getImageData(0,0,canvas.width,canvas.height);//get pixel data
var pixels = data.data;

for(var i = 0; i < pixels.length; i+=4){//loop through all data
  pixels[i] += a;
  pixels[i+1] += a;
  pixels[i+2] += a;
}
data.data = pixels;


ctx.putImageData(data,0,0);//put the image data back
$('#previw').attr('src',c.toDataURL('image/jpeg') );
}
function contrastScroll(amount){

ctx.drawImage(img, 0,0, img.naturalWidth, img.naturalHeight);

var a = parseInt(amount);

var data = ctx.getImageData(0,0,canvas.width,canvas.height);//get pixel data
var pixels = data.data;
for(var i = 0; i < pixels.length; i+=4){//loop through all data

  var brightness = (pixels[i]+pixels[i+1]+pixels[i+2])/3; //get the brightness

  pixels[i] += brightness > 127 ? a : -a;
  pixels[i+1] += brightness > 127 ? a : -a;
  pixels[i+2] += brightness > 127 ? a : -a;
}
data.data = pixels;
ctx.putImageData(data,0,0);//put the image data back
 $('#previw').attr('src',c.toDataURL('image/jpeg') );
}

function contrast(amount){
	var data = ctx.getImageData(0,0,canvas.width,canvas.height);//get pixel data
	var pixels = data.data;
	for(var i = 0; i < pixels.length; i+=4){//loop through all data

		var brightness = (pixels[i]+pixels[i+1]+pixels[i+2])/3; //get the brightness

		pixels[i] += brightness > 127 ? amount : -amount;
		pixels[i+1] += brightness > 127 ? amount : -amount;
		pixels[i+2] += brightness > 127 ? amount : -amount;
	}
	data.data = pixels;
	ctx.putImageData(data,0,0);//put the image data back
  $('#previw').attr('src',c.toDataURL('image/jpeg') );
}



</script>
</body>

</html>
